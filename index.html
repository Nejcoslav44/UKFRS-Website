<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Duty Hours Tracker</title>

<style>
:root{
  --text:#e9ecf5;
  --muted:#aeb7d3;
  --radius:18px;
  --mono: ui-monospace, Consolas, monospace;
  --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:var(--sans);
  color:var(--text);
  background:#0b1020;
  overflow-x:hidden;
}

/* ===== VIDEO BACKGROUND (NO FILTER) ===== */
.bg-video-wrap{
  position:fixed;
  inset:0;
  z-index:-5;
  overflow:hidden;
}
#bg-video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  object-position:center;
  filter:none; /* filter removed */
}

/* VERY LIGHT overlay only for readability */
.video-overlay{
  position:fixed;
  inset:0;
  z-index:-4;
  background: linear-gradient(
    180deg,
    rgba(5,10,20,0.35),
    rgba(5,10,20,0.45)
  );
  pointer-events:none;
}

/* ===== CONTENT ===== */
.wrap{
  max-width:980px;
  margin:0 auto;
  padding:42px 18px 64px;
  position:relative;
  z-index:1;
}
.top{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  margin-bottom:18px;
}
.brand h1{margin:0;font-size:28px;}
.brand p{margin:4px 0 0;color:var(--muted);font-size:14px;}

.pill{
  padding:10px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.15);
  font-size:13px;
  backdrop-filter:blur(8px);
}

.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:14px;
}
@media(min-width:920px){
  .grid{grid-template-columns:1.2fr .8fr;}
}

.card{
  background:rgba(15,20,35,0.55);
  border:1px solid rgba(255,255,255,.15);
  border-radius:var(--radius);
  padding:18px;
  backdrop-filter:blur(14px);
}

label{
  display:block;
  color:var(--muted);
  font-size:13px;
  margin:10px 0 6px;
}

textarea,input[type="date"]{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:rgba(10,12,22,.55);
  color:var(--text);
  font-family:var(--sans);
}

textarea{
  min-height:260px;
  resize:vertical;
  font-family:var(--mono);
  font-size:12px;
}

.row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
.row>*{flex:1}

.btnrow{
  display:flex;
  gap:10px;
  margin-top:12px;
}

button{
  padding:12px 16px;
  border-radius:14px;
  border:none;
  cursor:pointer;
  font-weight:600;
  background:linear-gradient(135deg,#7aa2ff,#7cffc7);
  color:#091023;
}
button.secondary{
  background:rgba(255,255,255,.08);
  color:var(--text);
  border:1px solid rgba(255,255,255,.2);
}

.error,.ok{
  margin-top:10px;
  padding:10px 12px;
  border-radius:12px;
  font-size:13px;
  display:none;
}
.error{
  background:rgba(255,100,100,.15);
  border:1px solid rgba(255,100,100,.4);
}
.ok{
  background:rgba(124,255,167,.15);
  border:1px solid rgba(124,255,167,.4);
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
  border-radius:14px;
  overflow:hidden;
  background:rgba(255,255,255,.05);
}
th,td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.1);
  font-size:13px;
}
th{color:var(--muted);}
tr:last-child td{border-bottom:none;}

.kpi{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:10px;
}
.kpi .box{
  padding:12px;
  border-radius:14px;
  background:rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
}
.kpi .t{color:var(--muted);font-size:12px;}
.kpi .v{font-size:20px;font-weight:700;margin-top:4px;}
</style>
</head>

<body>

<div class="bg-video-wrap">
  <video id="bg-video" autoplay muted loop playsinline preload="auto">
    <source src="./UKFRS_website_video.mp4" type="video/mp4">
  </video>
</div>
<div class="video-overlay"></div>

<div class="wrap">
  <div class="top">
    <div class="brand">
      <h1>Duty Hours Tracker</h1>
      <p>Paste Duty Logger exports and calculate totals.</p>
    </div>
    <div class="pill">All callsigns</div>
  </div>

  <div class="grid">
    <div class="card">
      <label>Duty Logger export</label>
      <textarea id="logs"></textarea>

      <div class="row">
        <div>
          <label>Start date</label>
          <input type="date" id="startDate">
        </div>
        <div>
          <label>End date</label>
          <input type="date" id="endDate">
        </div>
      </div>

      <div class="btnrow">
        <button id="getHoursBtn">Get hours</button>
        <button id="clearBtn" class="secondary">Clear</button>
      </div>

      <div id="appErr" class="error"></div>
      <div id="appOk" class="ok"></div>
    </div>

    <div class="card">
      <div class="kpi">
        <div class="box">
          <div class="t">View</div>
          <div class="v">All callsigns</div>
        </div>
        <div class="box">
          <div class="t">Total time</div>
          <div class="v" id="kpiTotal">00:00</div>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Callsign</th>
            <th>Total</th>
          </tr>
        </thead>
        <tbody id="resultsBody">
          <tr><td colspan="2" style="color:var(--muted)">No results yet.</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
const CALLSIGN_RE = /^(F(?:[1-9]|1[0-2]))$/i;
const DUTY_ENDED_RE = /\b(F(?:[1-9]|1[0-2]))\s*[—–-]\s*Duty\s+Ended\b/i;
const CALLSIGN_LINE_RE = /^\s*Callsign:\s*(F(?:[1-9]|1[0-2]))\s*$/i;
const DURATION_LINE_RE = /^\s*Duration:\s*(.+?)\s*$/i;
const ENDED_LINE_RE = /^\s*Ended:\s*(.+?)\s*$/i;

function durationToMinutes(t){
  const h=(/(\d+)\s*h/i.exec(t)||[])[1]||0;
  const m=(/(\d+)\s*m/i.exec(t)||[])[1]||0;
  return h*60+m*1;
}
function minutesToHHMM(t){
  const h=Math.floor(t/60),m=t%60;
  return String(h).padStart(2,"0")+":"+String(m).padStart(2,"0");
}

function extract(logText){
  const lines=logText.split("\n");
  const shifts=[];
  let inBlock=false,cs=null,mins=null;

  function finalize(){
    if(inBlock && cs && mins>0) shifts.push({cs,mins});
    inBlock=false;cs=null;mins=null;
  }

  for(const line of lines){
    const mStart=DUTY_ENDED_RE.exec(line);
    if(mStart){ finalize(); inBlock=true; cs=mStart[1].toUpperCase(); continue; }
    if(!inBlock) continue;
    const mCS=CALLSIGN_LINE_RE.exec(line);
    if(mCS) cs=mCS[1].toUpperCase();
    const mDur=DURATION_LINE_RE.exec(line);
    if(mDur) mins=durationToMinutes(mDur[1]);
    const mEnd=ENDED_LINE_RE.exec(line);
    if(mEnd) finalize();
  }
  finalize();
  return shifts;
}

document.getElementById("getHoursBtn").onclick=()=>{
  const logs=document.getElementById("logs").value;
  const resultsBody=document.getElementById("resultsBody");
  const kpiTotal=document.getElementById("kpiTotal");
  resultsBody.innerHTML="";
  const shifts=extract(logs);
  const totals={};
  shifts.forEach(s=> totals[s.cs]=(totals[s.cs]||0)+s.mins);
  let grand=0;
  Object.keys(totals).sort().forEach(cs=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${cs}</td><td>${minutesToHHMM(totals[cs])}</td>`;
    resultsBody.appendChild(tr);
    grand+=totals[cs];
  });
  kpiTotal.textContent=minutesToHHMM(grand);
};
document.getElementById("clearBtn").onclick=()=>{
  document.getElementById("logs").value="";
  document.getElementById("resultsBody").innerHTML='<tr><td colspan="2" style="color:var(--muted)">No results yet.</td></tr>';
  document.getElementById("kpiTotal").textContent="00:00";
};
</script>

</body>
</html>

