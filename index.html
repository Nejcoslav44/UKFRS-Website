<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FB Callsign Generator</title>
  <style>
    :root {
      --bg: #0b1020;
      --card: rgba(255,255,255,0.06);
      --card2: rgba(255,255,255,0.09);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.72);
      --border: rgba(255,255,255,0.16);
      --good: #34d399;
      --bad: #fb7185;
      --warn: #fbbf24;
      --btn: rgba(255,255,255,0.10);
      --btnHover: rgba(255,255,255,0.16);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(59,130,246,0.22), transparent 60%),
        radial-gradient(900px 500px at 85% 35%, rgba(168,85,247,0.18), transparent 60%),
        radial-gradient(900px 500px at 55% 95%, rgba(34,197,94,0.12), transparent 60%),
        var(--bg);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 28px 16px;
    }

    .wrap {
      width: min(980px, 100%);
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    header {
      padding: 18px 18px 4px;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 26px;
      letter-spacing: 0.2px;
    }
    p.sub {
      margin: 0;
      color: var(--muted);
      line-height: 1.35;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 16px;
    }

    @media (max-width: 860px) {
      .grid { grid-template-columns: 1fr; }
    }

    .card {
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0.03));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card .inner {
      padding: 16px;
    }

    .row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="text"]{
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.22);
      color: var(--text);
      outline: none;
      font-size: 15px;
    }
    input[type="text"]:focus{
      border-color: rgba(255,255,255,0.28);
      box-shadow: 0 0 0 3px rgba(59,130,246,0.18);
    }

    button {
      border: 1px solid var(--border);
      background: var(--btn);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.2px;
      transition: background .12s ease, transform .06s ease;
    }
    button:hover { background: var(--btnHover); }
    button:active { transform: translateY(1px); }
    button.primary {
      border-color: rgba(59,130,246,0.42);
      background: rgba(59,130,246,0.22);
    }
    button.primary:hover { background: rgba(59,130,246,0.28); }

    .status {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
      font-size: 14px;
      line-height: 1.3;
    }
    .status.good { border-color: rgba(52,211,153,0.35); color: rgba(209,250,229,0.95); }
    .status.bad  { border-color: rgba(251,113,133,0.35); color: rgba(255,228,230,0.95); }
    .status.warn { border-color: rgba(251,191,36,0.35);  color: rgba(254,243,199,0.95); }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
      color: var(--muted);
      font-size: 13px;
      user-select: none;
    }
    .mono { font-family: var(--mono); }

    .listWrap {
      padding: 0;
    }

    .listHead {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.12);
    }
    .listHead h2 {
      margin: 0;
      font-size: 16px;
      letter-spacing: 0.2px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      text-align: left;
      padding: 10px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.10);
      font-size: 14px;
    }
    th {
      color: var(--muted);
      font-weight: 600;
      background: rgba(0,0,0,0.08);
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tbody tr:hover td {
      background: rgba(255,255,255,0.04);
    }

    .actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .footerNote {
      padding: 10px 16px 16px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.35;
    }

    textarea {
      width: 100%;
      min-height: 120px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.22);
      color: var(--text);
      font-family: var(--mono);
      font-size: 12.5px;
      outline: none;
      resize: vertical;
    }

    .modalBg {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 50;
    }
    .modal {
      width: min(820px, 100%);
      border-radius: 18px;
      border: 1px solid var(--border);
      background: rgba(12,16,32,0.96);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .modalHead {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,0,0,0.18);
    }
    .modalHead strong { font-size: 14px; }
    .modalBody { padding: 14px 16px 16px; }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>FB Callsign Generator</h1>
      <p class="sub">
        Enter a name → click <b>Generate</b> → it assigns the next callsign starting at
        <span class="mono">FB-001</span> and adds it to the list. Duplicate names are blocked.
      </p>
    </header>

    <div class="grid">
      <!-- Generator -->
      <section class="card">
        <div class="inner">
          <div class="row" style="justify-content: space-between;">
            <div class="pill">
              Next callsign:
              <span id="nextCallsign" class="mono">FB-001</span>
            </div>
            <div class="pill">
              Total in list:
              <span id="totalCount" class="mono">0</span>
            </div>
          </div>

          <div style="margin-top: 14px;">
            <label for="nameInput">Name</label>
            <input id="nameInput" type="text" autocomplete="off" placeholder="e.g., Nejc Bergant" />
          </div>

          <div class="row" style="margin-top: 12px;">
            <button class="primary" id="generateBtn">Generate</button>
            <button id="copyLatestBtn" title="Copies the most recently generated callsign">Copy latest callsign</button>
          </div>

          <div id="statusBox" class="status" aria-live="polite">
            Ready.
          </div>

          <hr style="border: none; border-top: 1px solid rgba(255,255,255,0.12); margin: 14px 0;" />

          <div class="row" style="justify-content: space-between;">
            <div class="pill">
              Storage: <span class="mono">localStorage</span>
            </div>
            <div class="actions">
              <button id="exportBtn">Export JSON</button>
              <button id="importBtn">Import JSON</button>
              <button id="clearBtn" title="Clears the entire list and resets callsign counter">Clear</button>
            </div>
          </div>

          <p class="footerNote">
            Notes: Name matching is case-insensitive and ignores extra spaces. If you want strict matching, tell me and I’ll adjust it.
          </p>
        </div>
      </section>

      <!-- List -->
      <section class="card listWrap">
        <div class="listHead">
          <h2>Assigned Callsigns</h2>
          <div class="pill">
            Sort:
            <span class="mono">FB-###</span>
          </div>
        </div>

        <div style="max-height: 420px; overflow: auto;">
          <table>
            <thead>
              <tr>
                <th style="width: 120px;">Callsign</th>
                <th>Name</th>
              </tr>
            </thead>
            <tbody id="listBody">
              <!-- rows injected -->
            </tbody>
          </table>
        </div>

        <div class="footerNote">
          Tip: If you’re hosting on GitHub Pages, this works as-is. LocalStorage is per-browser/device.
        </div>
      </section>
    </div>
  </div>

  <!-- Modal for Import/Export -->
  <div id="modalBg" class="modalBg" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <div class="modalHead">
        <strong id="modalTitle">Export / Import</strong>
        <button id="closeModalBtn">Close</button>
      </div>
      <div class="modalBody">
        <div id="modalHint" style="color: rgba(255,255,255,0.75); font-size: 13px; margin-bottom: 10px;"></div>
        <textarea id="modalText" spellcheck="false"></textarea>
        <div class="row" style="margin-top: 10px; justify-content: flex-end;">
          <button id="modalPrimaryBtn" class="primary">OK</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== Storage keys ======
    const STORAGE_KEY = "fb_callsign_list_v1";
    const COUNTER_KEY = "fb_callsign_counter_v1";
    const LATEST_KEY  = "fb_callsign_latest_v1";

    // ====== State ======
    /** @type {{name: string, callsign: string}[]} */
    let entries = [];
    let nextNumber = 1; // FB-001 => 1

    // ====== Helpers ======
    function normalizeName(raw) {
      return raw.trim().replace(/\s+/g, " ");
    }
    function normalizeNameKey(raw) {
      return normalizeName(raw).toLowerCase();
    }
    function pad3(n) {
      const s = String(n);
      return s.length >= 3 ? s : "0".repeat(3 - s.length) + s;
    }
    function toCallsign(n) {
      return `FB-${pad3(n)}`;
    }

    function setStatus(message, kind = "neutral") {
      const box = document.getElementById("statusBox");
      box.textContent = message;
      box.classList.remove("good", "bad", "warn");
      if (kind === "good") box.classList.add("good");
      if (kind === "bad") box.classList.add("bad");
      if (kind === "warn") box.classList.add("warn");
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
      localStorage.setItem(COUNTER_KEY, String(nextNumber));
    }

    function loadState() {
      try {
        const rawEntries = localStorage.getItem(STORAGE_KEY);
        const rawCounter = localStorage.getItem(COUNTER_KEY);

        entries = rawEntries ? JSON.parse(rawEntries) : [];
        if (!Array.isArray(entries)) entries = [];

        const parsedCounter = rawCounter ? parseInt(rawCounter, 10) : NaN;
        nextNumber = Number.isFinite(parsedCounter) && parsedCounter >= 1 ? parsedCounter : 1;
      } catch {
        entries = [];
        nextNumber = 1;
      }
    }

    function render() {
      document.getElementById("nextCallsign").textContent = toCallsign(nextNumber);
      document.getElementById("totalCount").textContent = String(entries.length);

      const tbody = document.getElementById("listBody");
      tbody.innerHTML = "";

      // Sort by callsign number ascending
      const sorted = [...entries].sort((a, b) => {
        const na = parseInt(a.callsign.split("-")[1], 10);
        const nb = parseInt(b.callsign.split("-")[1], 10);
        return na - nb;
      });

      for (const e of sorted) {
        const tr = document.createElement("tr");

        const tdCall = document.createElement("td");
        tdCall.textContent = e.callsign;
        tdCall.className = "mono";

        const tdName = document.createElement("td");
        tdName.textContent = e.name;

        tr.appendChild(tdCall);
        tr.appendChild(tdName);
        tbody.appendChild(tr);
      }
    }

    function nameExists(nameRaw) {
      const key = normalizeNameKey(nameRaw);
      return entries.some(e => normalizeNameKey(e.name) === key);
    }

    // ====== Modal (Import/Export) ======
    const modalBg = document.getElementById("modalBg");
    const modalTitle = document.getElementById("modalTitle");
    const modalHint = document.getElementById("modalHint");
    const modalText = document.getElementById("modalText");
    const modalPrimaryBtn = document.getElementById("modalPrimaryBtn");
    const closeModalBtn = document.getElementById("closeModalBtn");

    let modalMode = "export"; // "export" | "import"

    function openModal(mode) {
      modalMode = mode;
      modalText.value = "";
      modalText.readOnly = (mode === "export");

      if (mode === "export") {
        modalTitle.textContent = "Export JSON";
        modalHint.textContent = "Copy this JSON somewhere safe. You can import it later on another device/browser.";
        const payload = {
          version: 1,
          nextNumber,
          entries
        };
        modalText.value = JSON.stringify(payload, null, 2);
        modalPrimaryBtn.textContent = "Copy to clipboard";
      } else {
        modalTitle.textContent = "Import JSON";
        modalHint.textContent = "Paste previously exported JSON here. This will replace your current list.";
        modalPrimaryBtn.textContent = "Import";
      }

      modalBg.style.display = "flex";
      setTimeout(() => modalText.focus(), 0);
    }

    function closeModal() {
      modalBg.style.display = "none";
    }

    closeModalBtn.addEventListener("click", closeModal);
    modalBg.addEventListener("click", (e) => {
      if (e.target === modalBg) closeModal();
    });
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modalBg.style.display === "flex") closeModal();
    });

    modalPrimaryBtn.addEventListener("click", async () => {
      if (modalMode === "export") {
        try {
          await navigator.clipboard.writeText(modalText.value);
          setStatus("Export copied to clipboard.", "good");
          closeModal();
        } catch {
          setStatus("Could not access clipboard. Manually copy the JSON from the modal.", "warn");
        }
        return;
      }

      // import
      try {
        const payload = JSON.parse(modalText.value);
        if (!payload || typeof payload !== "object") throw new Error("Invalid payload");

        const importedEntries = payload.entries;
        const importedNext = payload.nextNumber;

        if (!Array.isArray(importedEntries)) throw new Error("entries must be an array");
        if (!Number.isFinite(importedNext) || importedNext < 1) throw new Error("nextNumber must be >= 1");

        // Basic shape validation
        for (const item of importedEntries) {
          if (!item || typeof item !== "object") throw new Error("Bad entry");
          if (typeof item.name !== "string" || typeof item.callsign !== "string") throw new Error("Bad entry fields");
          if (!/^FB-\d{3,}$/.test(item.callsign)) throw new Error("Bad callsign format");
        }

        entries = importedEntries.map(e => ({
          name: normalizeName(e.name),
          callsign: e.callsign
        }));

        // Remove duplicate names on import (keep first occurrence)
        const seen = new Set();
        entries = entries.filter(e => {
          const k = normalizeNameKey(e.name);
          if (seen.has(k)) return false;
          seen.add(k);
          return true;
        });

        nextNumber = importedNext;
        saveState();
        render();
        setStatus("Imported successfully.", "good");
        closeModal();
      } catch (err) {
        setStatus("Import failed: invalid JSON or format.", "bad");
      }
    });

    // ====== Main actions ======
    document.getElementById("generateBtn").addEventListener("click", () => {
      const input = document.getElementById("nameInput");
      const raw = input.value;
      const name = normalizeName(raw);

      if (!name) {
        setStatus("Enter a name first.", "warn");
        input.focus();
        return;
      }

      if (nameExists(name)) {
        setStatus("Name already in list", "bad");
        return;
      }

      const callsign = toCallsign(nextNumber);
      entries.push({ name, callsign });
      localStorage.setItem(LATEST_KEY, callsign);

      nextNumber += 1;
      saveState();
      render();

      setStatus(`Assigned ${callsign} to "${name}".`, "good");
      input.value = "";
      input.focus();
    });

    document.getElementById("nameInput").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        document.getElementById("generateBtn").click();
      }
    });

    document.getElementById("copyLatestBtn").addEventListener("click", async () => {
      const latest = localStorage.getItem(LATEST_KEY);
      if (!latest) {
        setStatus("No callsign generated yet.", "warn");
        return;
      }
      try {
        await navigator.clipboard.writeText(latest);
        setStatus(`Copied ${latest} to clipboard.`, "good");
      } catch {
        setStatus("Could not access clipboard. Copy manually from the list.", "warn");
      }
    });

    document.getElementById("exportBtn").addEventListener("click", () => openModal("export"));
    document.getElementById("importBtn").addEventListener("click", () => openModal("import"));

    document.getElementById("clearBtn").addEventListener("click", () => {
      const ok = confirm("Clear the entire list and reset callsign counter to FB-001?");
      if (!ok) return;

      entries = [];
      nextNumber = 1;
      localStorage.removeItem(LATEST_KEY);
      saveState();
      render();
      setStatus("Cleared. Counter reset to FB-001.", "good");
    });

    // ====== Init ======
    loadState();
    render();
  </script>
</body>
</html>


